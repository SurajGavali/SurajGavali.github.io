<!DOCTYPE html>
<html class="no-js" lang="en">
<head>

    <title>Operating Systems</title>

    <!--- basic page needs
    ================================================== -->
   
    <meta name="description" content="">
    <meta name="author" content="">

   <!-- mobile specific metas
    ================================================== -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS
    ================================================== -->
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/vendor.css">

    <!-- script
    ================================================== -->
    <script src="../js/modernizr.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js?lang=c&amp;skin=sons-of-obsidian"></script>

    <!-- favicons
    ================================================== -->
    <link rel="apple-touch-icon" sizes="180x180" href="../logo.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../logo.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../logo.png">
    <link rel="manifest" href="site.webmanifest">

</head>

<body id="top">


    <!-- preloader
    ================================================== -->
    <div id="preloader">
        <div id="loader"></div>
    </div>


    <!-- header
    ================================================== -->
    <header class="s-header">

        <div class="row s-header__content">

            <div class="s-header__logo">
                <a class="logo" href="../index.html">
                    <img src="../images/logo.png" alt="Homepage">
                </a>
            </div>

            <nav class="s-header__nav-wrap">

                <h2 class="s-header__nav-heading h6">Site Navigation</h2>

                <ul class="s-header__nav">
                    <li><a href="index.html" title="">Home</a></li>
                    <li class="has-children">
                        <a href="#0" title="">Categories</a>
                        <ul class="sub-menu">
                            <li><a href="ctechnical.html">Technical</a></li>
                            <li><a href="cart.html">Art</a></li>
                            <li><a href="cphotography.html">Photography</a></li>
                            <!-- <li><a href="category.html">Vacation</a></li>
                            <li><a href="category.html">Work</a></li>
                            <li><a href="category.html">Health</a></li>
                            <li><a href="category.html">Family</a></li>
                            <li><a href="category.html">Relationship</a></li> -->
                        </ul>
                    </li>
                   <!--  <li class="has-children current">
                        <a href="#0" title="">Blog</a>
                        <ul class="sub-menu">
                        <li><a href="single-video.html">Video Post</a></li>
                        <li><a href="single-audio.html">Audio Post</a></li>
                        <li><a href="single-gallery.html">Gallery Post</a></li>
                        <li><a href="single-standard.html">Standard Post</a></li>
                        </ul>
                    </li> -->
                    <!-- <li><a href="styles.html" title="">Styles</a></li> -->
                    <li><a href="about.html" title="">About</a></li>
                    <li><a href="contact.html" title="">Contact</a></li>
                </ul> <!-- end header__nav -->

                <a href="#0" title="Close Menu" class="s-header__overlay-close close-mobile-menu">Close</a>

            </nav> <!-- end header__nav-wrap -->
                   
            <a class="s-header__toggle-menu" href="#0" title="Menu"><span>Menu</span></a>
            
            <!-- <div class="s-header__search"> -->
                    
                <!-- <form role="search" method="get" class="s-header__search-form" action="#">
                    <label>
                        <span class="hide-content">Search for:</span>
                        <input type="search" class="s-header__search-field" placeholder="Type Your Keywords" value="" name="s" title="Search for:" autocomplete="off" id="search">
                    </label>
                    <input type="submit" class="s-header__search-submit" value="submit" id="submit_form" onclick="checkInput()">
                </form> -->

                <!-- <a href="#0" title="Close Search" class="s-header__overlay-close">Close</a> -->

            <!-- </div>  --><!-- end search wrap --> 


            <a class="s-header__search-trigger" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 18a7.952 7.952 0 004.897-1.688l4.396 4.396 1.414-1.414-4.396-4.396A7.952 7.952 0 0018 10c0-4.411-3.589-8-8-8s-8 3.589-8 8 3.589 8 8 8zm0-14c3.309 0 6 2.691 6 6s-2.691 6-6 6-6-2.691-6-6 2.691-6 6-6z"></path></svg>
            </a>

        </div> <!-- end s-header__content -->

    </header> <!-- end header -->


    <!-- content
    ================================================== -->
    <section class="s-content s-content--single">
        <div class="row">
            <div class="column large-12">

                <article class="s-post entry format-standard">

                    
                    <h2 class="s-content__title s-content__title--post">Compiler and Machine code generation</h2>

                    <br>
                    
                    <div class="s-content__media">
                        <div class="s-content__post-thumb"> 
                            <img src="c code to machine code example.png" 
                                    srcset="c code to machine code example.png 2100w, 
                                            c code to machine code example.png 1050w, 
                                            c code to machine code example.png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>
                    </div> <!-- end s-content__media -->

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">Across function calls</h2>

                    <pre class="prettyprint" style="overflow: scroll; height: 500px">
                        #include "stdio.h" 
                        #include "stdlib.h" // For exit() 
                      
                        int f(int m,n){

                            int x = m, y = n;
                            return g(x,y);
                        }
                        int x(int a){

                            return g(a,a+1);
                        }
                        int g(int p, int q){

                            p = = p * q + p;
                            return p;
                        }
                </pre>

                    <p class="lead">Here in above code the function "g" may be called from function "f()" or function "x()".Compiler do not predict anything about sequence of function call!</p>

                    <p class="lead">So compiler has to generate machine code for each function assuming nothing about caller.</p>

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">Machine code generation for function</h2>

                    <div class="s-content__media">
                        <div class="s-content__post-thumb"> 
                            <img src="machine code genaration for functions.png" 
                                    srcset="machine code genaration for functions.png 2100w, 
                                            machine code genaration for functions.png 1050w, 
                                            machine code genaration for functions.png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>
                    </div> <!-- end s-content__media -->

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: red;">Where are the local variables in memory?</h2>

                    <p class="lead">---> The only way to store them is on a stack!(why?, let's see.)</p>

                    <p class="lead" style="color: blue">We know that function calls happens in "LIFO" fashion.(Hence must need stack like data structure to implement)</p>

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">System stack</h2>

                    <p class="lead">Processor provide stack pointer(%esp on x86).</p>
                    <p class="lead">Instructions like push and pop are provided by hardware. they automatically increment and decrement the stack pointer. x86 stack goes downwards i.e. pop means increment and push means decrement!</p>

                    <div class="s-content__media">
                        <div class="s-content__post-thumb"> 
                            <img src="what goes on stack.png" 
                                    srcset="what goes on stack.png 2100w, 
                                            what goes on stack.png 1050w, 
                                            what goes on stack.png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>
                    </div> <!-- end s-content__media -->

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">Activation record</h2>

                    <p class="lead" style="color: red">Local variables + parameters + return address (Activation record is fo r one particular function call)</p>

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: red;">When functions call each other : </h2>

                    <p class="lead">One activation reacord is built on stack for each function call and on function return the record is destroyed.</p>

                    <p class="lead">O x86 ebp and esp pointers are used to denote the activation record.(e for 32-bit and for 64-bit it is rbp and rsp)</p>

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">x86 instructions</h2>

                    <div class="s-content__media">
                        <div class="s-content__post-thumb"> 
                            <img src="x86 instr.png" 
                                    srcset="x86 instr.png 2100w, 
                                            x86 instr.png 1050w, 
                                            x86 instr.png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>
                    </div> <!-- end s-content__media -->

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">endbr64 - Normally a NOP(No operation instruction)</h2>

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: center;font-size: 30px;color: blue;">Let's compile using gcc -S see the code and understand!</h2>

                    
                    <div class="s-content__media">
                        <div class="s-content__post-thumb"> 
                            <img src="sample code.png" 
                                    srcset="sample code.png 2100w, 
                                            sample code.png 1050w, 
                                            sample code.png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>
                    </div> <!-- end s-content__media -->

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">At Initial stage</h2>


                    <div class="s-content__media">
                        <div class="s-content__post-thumb"> 
                            <img src="initial stage.png" 
                                    srcset="initial stage.png 2100w, 
                                            initial stage.png 1050w, 
                                            initial stage.png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>

                    </div> <!-- end s-content__media -->

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">After execution of "pushq %rbp"</h2>

                    <div class="s-content__media">
                        
                        <div class="s-content__post-thumb"> 
                            <img src="2nd stage.png" 
                                    srcset="2nd stage.png 2100w, 
                                            2nd stage.png 1050w, 
                                            2nd stage.png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>
                    </div> <!-- end s-content__media -->

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">After execution of "movq %rsp, %rbp"</h2>

                    <div class="s-content__media">
                        
                        <div class="s-content__post-thumb"> 
                            <img src="3rd stage.png" 
                                    srcset="3rd stage.png 2100w, 
                                            3rd stage.png 1050w, 
                                            3rd stage.png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>
                    </div> <!-- end s-content__media -->

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">After execution of "subq $16, %rsp" this is equivalent to allocating 16 bytes on stack</h2>

                    <div class="s-content__media">
                        
                        <div class="s-content__post-thumb"> 
                            <img src="4th stage.png" 
                                    srcset="4th stage.png 2100w, 
                                            4th stage.png 1050w, 
                                            4th stage.png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>
                    </div> <!-- end s-content__media -->

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">After execution of "movl $20, -8(%rbp) and movl $30, -4(%rbp)"</h2>

                    <div class="s-content__media">
                        
                        <div class="s-content__post-thumb"> 
                            <img src="5th stage.png" 
                                    srcset="5th stage.png 2100w, 
                                            5th stage.png 1050w, 
                                            5th stage.png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>
                    </div> <!-- end s-content__media -->

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">After execution of "movl -8(%rbp), %eax and movl %eax, %edi basically copy of %eax is made "</h2>

                    <div class="s-content__media">
                        
                        <div class="s-content__post-thumb"> 
                            <img src="6th stage.png" 
                                    srcset="6th stage.png 2100w, 
                                            6th stage.png 1050w, 
                                            6th stage.png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>
                    </div> <!-- end s-content__media -->

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">Now the call to function "f" will happen, after execution of this instruction the address next to the "call f" instruction is pushed on to the stack!(here to understan we have labled it as RA) after this the code of function f() started executing. </h2>

                    <div class="s-content__media">
                        
                        <div class="s-content__post-thumb"> 
                            <img src="call f.png" 
                                    srcset="call f.png 2100w, 
                                            call f.png 1050w, 
                                            call f.png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>
                    </div> <!-- end s-content__media -->

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">After executing "pushq %rbp" the content of where rbp is pointing is pushed on to the stack i.e. Y - 4.</h2>

                    <div class="s-content__media">
                        
                        <div class="s-content__post-thumb"> 
                            <img src="start of f.png" 
                                    srcset="start of f.png 2100w, 
                                            start of f.png 1050w, 
                                            start of f.png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>
                    </div> <!-- end s-content__media -->

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">After executing "movq %rsp, %rbp" rbp gets pointed to where the rsp is pointing.</h2>

                    <div class="s-content__media">
                        
                        <div class="s-content__post-thumb"> 
                            <img src="pointing rbp.png" 
                                    srcset="pointing rbp.png 2100w, 
                                            pointing rbp.png 1050w, 
                                            pointing rbp.png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>
                    </div> <!-- end s-content__media -->

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">After executing "movl %edi, -20(%rbp)" the edi contents get copied at -20(rbp) location. all this line does is pass by value.</h2>

                    <div class="s-content__media">
                        
                        <div class="s-content__post-thumb"> 
                            <img src="Screenshot (19).png" 
                                    srcset="Screenshot (19).png 2100w, 
                                            Screenshot (19).png 1050w, 
                                            Screenshot (19).png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>
                    </div> <!-- end s-content__media -->

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">After executing "movl -20(%rbp),%eax ; addl $3 , %eax ; movl %eax , -4(%rbp)" the -20(%rbp) is pointed where the eax is pointing and then eax register contents add with 3 and eax starts pointing to -4(%rbp location)</h2>

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">After executing "popq %rbp" the contents of where %rsp is pointing are gets copied at location where %rbp is pointing i.e. Y - 4. and the stack pointer is decremented. now the "ret" executes and the we come back to main! </h2>

                    <div class="s-content__media">
                        
                        <div class="s-content__post-thumb"> 
                            <img src="Screenshot (21).png" 
                                    srcset="Screenshot (21).png 2100w, 
                                            Screenshot (21).png 1050w, 
                                            Screenshot (21).png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>
                    </div> <!-- end s-content__media -->

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">After executing "movl %eax, -4(%rbp) and movl -4(%rbp),%eax" the eax contents get copied to -4(%rbp) and -4(%rbp) starts pointing eax i.e. b changes from 30 to 23. </h2>

                    <div class="s-content__media">
                        
                        <div class="s-content__post-thumb"> 
                            <img src="Screenshot (22).png" 
                                    srcset="Screenshot (22).png 2100w, 
                                            Screenshot (22).png 1050w, 
                                            Screenshot (22).png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>
                    </div> <!-- end s-content__media -->

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">After executing "leave"</h2>

                    <div class="s-content__media">
                        
                        <div class="s-content__post-thumb"> 
                            <img src="Screenshot (23).png" 
                                    srcset="Screenshot (23).png 2100w, 
                                            Screenshot (23).png 1050w, 
                                            Screenshot (23).png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>
                    </div> <!-- end s-content__media -->

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: red;">Caller save register</h2>

                    <p class="lead">Which functions need to be saved by caller function. they can be used by the callee function i.e. suppose edi ,eax ,ecx registers they need to be saved by caller function and caller assumes that called function will use them!</p>

                    <p class="lead">The caller function will push them(If already in use, othewise no need) on the stack.</p>

                     <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: red;">Callee save register</h2>

                     <p class="lead">Will be pushed on to the stack by called(callee) function.</p>


                     <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">x86 convention - caller,callee saved 32-bit</h2>

                     <p class="lead">The caller-saved registers are EAX,ECX and EDX.</p>
                     <p class="lead">The caller-saved registers are EBX,EDI and ESI.</p>

                     <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">Activation record looks like this</h2>

                     <div class="s-content__media">
                        
                        <div class="s-content__post-thumb"> 
                            <img src="Screenshot (24).png" 
                                    srcset="Screenshot (24).png 2100w, 
                                            Screenshot (24).png 1050w, 
                                            Screenshot (24).png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>
                    </div> <!-- end s-content__media -->

                    <p class="lead" style="color: red">The return address will be always above "ebp"</p>

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">x86 caller and callee rules(32-bit)</h2>

                    <div class="s-content__media">
                        
                        <div class="s-content__post-thumb"> 
                            <img src="Screenshot (25).png" 
                                    srcset="Screenshot (25).png 2100w, 
                                            Screenshot (25).png 1050w, 
                                            Screenshot (25).png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>
                    </div> <!-- end s-content__media -->

                    <div class="s-content__media">
                        
                        <div class="s-content__post-thumb"> 
                            <img src="Screenshot (26).png" 
                                    srcset="Screenshot (26).png 2100w, 
                                            Screenshot (26).png 1050w, 
                                            Screenshot (26).png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>
                    </div> <!-- end s-content__media -->

                    <div class="s-content__media">
                        
                        <div class="s-content__post-thumb"> 
                            <img src="Screenshot (27).png" 
                                    srcset="Screenshot (27).png 2100w, 
                                            Screenshot (27).png 1050w, 
                                            Screenshot (27).png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>
                    </div> <!-- end s-content__media -->

                    <h2 h2 class="s-content__title s-content__title--post" style="text-align: left;font-size: 30px;color: grey;">Another Example</h2>

                    <div class="s-content__media">
                        
                        <div class="s-content__post-thumb"> 
                            <img src="Screenshot (28).png" 
                                    srcset="Screenshot (28).png 2100w, 
                                            Screenshot (28).png 1050w, 
                                            Screenshot (28).png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>
                    </div> <!-- end s-content__media -->

                    <div class="s-content__media">
                        
                        <div class="s-content__post-thumb"> 
                            <img src="Screenshot (29).png" 
                                    srcset="Screenshot (29).png 2100w, 
                                            Screenshot (29).png 1050w, 
                                            Screenshot (29).png 525w" style="width: 100%; margin-left: 0px" alt="">
                        </div>
                    </div> <!-- end s-content__media -->
                    

                        <div class="s-content__pagenav group">
                             <div class="next-nav" style="text-align: left;">
                                 <a href="system programming.html" rel="next">
                                    Previous
                                 </a>
                             </div>

                             <div class="next-nav" style="text-align: right;">
                                 <a href="basics of x86 architecture.html" rel="next">
                                    Next
                                 </a>
                             </div>
                         </div> <!-- end s-content__pagenav -->
                    </div> <!-- end s-content__primary -->
                </article>

            </div> <!-- end column -->
        </div> <!-- end row -->

    </section> <!-- end s-content -->


    <!-- footer
    ================================================== -->
    <footer class="s-footer">

        <div class="s-footer__bottom">
            <div class="row">
                <div class="column">
                    <div class="ss-copyright">
                        <span>Â© Copyright Suraj 2021</span> 
                        <span>Course by <a href="../index.html">Suraj</a></span>                 
                    </div> <!-- end ss-copyright -->
                </div>
            </div> 

            <div class="ss-go-top">
                <a class="smoothscroll" title="Back to Top" href="#top">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 4h12v2H6zm5 10v6h2v-6h5l-6-6-6 6z"/></svg>
                </a>
            </div> <!-- end ss-go-top -->
        </div> <!-- end s-footer__bottom -->

   </footer> <!-- end s-footer -->


   <!-- Java Script
   ================================================== --> 
   <script src="../js/jquery-3.2.1.min.js"></script>
   <script src="../js/plugins.js"></script>
   <script src="../js/main.js"></script>
   
</script>

</body>

</html>